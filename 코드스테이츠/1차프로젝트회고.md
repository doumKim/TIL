# Surf 🏄🏼‍♂️🏄🏼‍♀️

![서핑하고 있는 여자](https://images.velog.io/images/kdo0129/post/3928f7c8-8a77-4736-9949-bf950161b7e0/surfer.jpg)

## 👩‍🦳 프로젝트 안내

- ### **프로젝트 명**

  Surf

- ### **프로젝트 기간**

  20.09.21 - 20.10.05 (2주 프로젝트)

- ### ** Github repo **

  - [Server](https://github.com/doumKim/surf-server-repo)
  - [Client](https://github.com/doumKim/surf-client-repo)

- ### **팀원 & Work log**

  - [이혁원](https://github.com/piecemakerz) (Front)
    - 프로젝트의 전반적인 관리
    - 인증 및 권한
    - 리덕스 상태 관리
  - [강한결](https://github.com/hankyeolk) (Front)
    - 페이지 반응형 디자인
    - 로그인 / 회원가입, 비밀번호 변경, 아바타 변경
    - 좋아요 기능, 글 작성 / 글 이어가기, 글 상세보기
  - [김태원](https://github.com/ktw3577) (Back)

    - API, DB 문서 관리 및 작성
    - AWS 배포 세팅 (S3,EC2,RDS 개설 및 연결)
    - 이미지 업로드 기능 (multer)
    - 라우팅 및 포스트 컨트롤러

  - [김도움](https://github.com/doumKim) (Back)
    - 모델 , 스키마 생성 및 유저 컨트롤러
    - 로컬 , 소셜 로그인 (인증 구현)
    - Https 세팅 (Route 53, ACM, CloudFront)
    - 디자인 시안 작업 (제플린, 스케치)

---

## 기획

본격적인 작업을 시작하기 전에 SR 시간을 가졌다.

아이디어 회의 결과로 나온 한결님의 Surf 라는 아이템을 선택을 했고 Surf라는 프로젝트는 온라인으로 웹 소설을 서로 다른 사람이 릴레이 형식으로 연재하는 플랫폼을 제작하는 것이다.

소셜 네트워크 프로젝트를 한번 쯤 해보고 싶었던 나로써는 굉장히 좋은 아이템으로 보였다.

일단 우리가 구현할 큰 기능을 설명을 하자면 4가지 정도가 있다.

1. 인증

2. 파도 일으키기 ( 새로운 글 작성 시작하기 )

3. 파도 타기 ( 소설 릴레이 작성하기)

4. 좋아요 기능

### Bare minimum requirements

우리가 구현할 최소 요구사항을 적어보면 아래와 같다.

#### 👷🏼‍♂️ 기능 (CRUD)

- Create

  - 회원가입 - 유저 데이터 생성
  - 파도 일으키기 - 소설 시작하기, 소설 릴레이 1회차 생성 (텍스트, 카테고리, 이미지 등 생성)

  - 파도 이어가기 - 릴레이 소설 이어가기, 소설 릴레이 1회차 생성 (텍스트)

- Read

  - 로그인 - 유저 데이터 조회 후 인증, 권한 부여

  - 글 조회 - DB에 저장된 포스트 (글) 조회 (좋아요, 북마크, 생성한 글, 참여한 글 전부 조회)

  - 마이페이지 - 유저 정보 조회

- Update

  - 마이페이지 - 유저 정보 수정 (패스워드, 프로필 이미지, 닉네임, 레벨 업데이트)

  - 글 작성 - 임시 저장 글 불러와서 텍스트 수정 후 DB 저장

- Delete
  - 로그아웃 - 유저 세션 정보 삭제

### UI 디자인

사실 기획에서 가장 걱정했던 부분 중에 하나이다.

팀에서 디자인을 해봤던 사람도 없었고 남자 4명이라 감각도 매우 떨어졌다 🤣

그래서 내 목표는 그냥 욕 나올 정도로 구려 보이지 말자였다.😂 😂

디자인은 스케치로 했고 제플린으로 시안 공유를 했다.

#### 💻 PC-Design

![데스크탑 디자인 시안](https://images.velog.io/images/kdo0129/post/c8bb7872-24d0-44b3-ab9e-974c54f498f0/image.png)

#### 🎮 Tablet-Design

![태블릿 디자인 시안](https://images.velog.io/images/kdo0129/post/6cf1cdd7-7afa-4861-8cd5-8f748c45efb6/image.png)

#### 📱 Mobile-Design

![모바일 디자인 시안](https://images.velog.io/images/kdo0129/post/e7ab037a-0423-4934-b1a2-96dbb9f19f22/image.png)

내가 메인 시안을 만들고 테마를 이상하게 선택해서 그런가 다음에 한결님이 다른 페이지 작업을 해도 그렇게 보기 좋지는 않더라....

역시 디자인은 디자이너에게 맡겨야한다는 사실을 또 한번 깨달았다..!!

근데 이런 거지같은 디자인도 만드는데 거의 하루를 소비했다는 점...😞

차라리 어차피 디자인 이상한거 포기하고 기능에 좀 더 시간을 썼으면 좋겠다는 후회도 살짝 든다.

### DB diagram

일단 우리는 DB에서 4개의 테이블을 생각했다.

1. 사용자의 데이터를 저장하는 users
2. 게시물의 데이터를 저장하는 posts
3. 파도 이어가기 글에 대한 데이터를 저장하는 phase_posts
4. 좋아요를 한 게시물, 유저를 저장하는 like_post

일단 기획처럼 마지막 배포까지 유지는 했는데 문제점이 있기는 했다.

그 부분에 대해서는 잠시 후에 살펴보기로 하자.

![데이터베이스 다이어그램](https://images.velog.io/images/kdo0129/post/b9e0063d-75c5-48ef-ab00-4bb5b3660069/db_schema.png)

### 👮🏼‍ Team Rule

사실 이 부분에서는 나를 포함한 팀원 모두가 부족한 점과 실망스러운 점이 아주 많다.

특히 우리는 코드 스타일도 어느정도 컨벤션을 기획에 넣었지만 매우 지켜지지 않았고

깃헙 커밋, 이슈, 프로젝트 관리도 너무 엉망이었다.

특히 git-flow를 정했지만 브랜치 관리도 너무 처참했다.

사실 1차 프로젝트에서 기술적인 부분 보다는 협업 부분에서 얻어갈 점이 많다고 생각했는데 너무 잘 지켜지지 않아서 조금 실망스럽다.

깃헙 위키를 보니깐 아주 귀여운 규칙도 정해놨더라 ~~_**추석 연휴 배려하기라.......**_~~

#### ❗️ 팀 내 자체 규칙

> - 이슈 발생 시 즉시 슬랙에 공유하기
>
> - 추석 연휴 최대한 배려하기 ~~_**( 네......? )**_~~
>
> - 일요일에는 긴급한 이슈만 공유하기 ~~_**( 네......? )**_~~
>
> - 최대한 가능한 시간 내에서 많이 자기 ~~_**( 네......? )**_~~

### API DOCS

API 문서는 깃북을 통해서 관리를 했다.

#### [Surf API DOCS](https://taewongim06.gitbook.io/frist/untitled)

여기서도 기획이 참 중요하고 잘 지켜야하는지 또 깨달았는데 API 문서를 만들기만 하면 뭐하나..

항상 작업을 하다보면 기획과는 다르게 변경이 될 수 있는 법!

그렇기에 항상 최신화 작업을 해줘야 미래의 나 자신과 다른 팀원이 편하게 작업할 수 있다는 점이다.

![API 문서](https://images.velog.io/images/kdo0129/post/1ff67a17-25c1-4eb7-9d31-e4ac938fccce/image.png)

## 회고

이번 프로젝트에서는 난 백엔드를 담당했다.

일단 프론트는 어느 정도 만져봤던 경험이 있어서 1차 프로젝트에서 백엔드 기초를 잘 다져보자가 목표였다.

### 1차 위기 DB ⚒️

나는 사실 데이터 베이스 다이어그램 작성부터 살짝 멘붕이었다.

다른 팀원이 어찌 어찌 작성은 했지만 테이블 관계에 대해서 너무 무지했나 보다 왜 좋아요 때문에 유저와 포스트가 N:M 관계를 가져야 하는지도 몰랐고 그 조인 테이블을 만들어 무엇을 해야할지도 감이 오지를 않았다.

그래서 거의 작업 첫날은 데이터베이스에 대해서 엄청 팠던거 같다.

왜 테이블 간의 관계 설정을 해주는 것이고 그걸 위해 조인 테이블이 생기고 FK는 무엇이고

그래도 한 2일 정도 미친듯이 부딪혀보니 **신기하게 어느정도 감은 오더라**...

그렇게 데이터 베이스 다이어그램을 보고도 이해를 못하던 내가 직접 시퀄라이즈로 모델을 생성하고 관계 설정을 하고 있는데 참.. 하면 다 되는구나 깨달았다.

사실 여기서부터 동기부여가 확 이뤄진거 같다.

그렇게 쭉쭉 DB 작업을 맞추고 나니 또 문제가 발생하였다.

### 🍪 쿠키가 생기질 않아 🍪

프로젝트 기획에서는 인증 부분을 세션 방식으로 처리하려고 해서 우리는 `node.js, express` 기반의 서버이기 때문에 `express-session`을 이용해서 세션을 구현했다.

우리는 다른 도메인끼리 쿠키를 전송해야하기 때문에 `https` 세팅을 해야한다는 소리를 어디서 들었는지 일단 `aws Route 53`에서 도메인을 등록하고 `ACM`에서 인증서 발급하고 `S3`에 `Cloudfront`를 연결하고 `EC2`도 마찬가지로 `로드밸런서` 세팅과 도메인 등록을 해주었다.

하지만 클라이언트의 도메인과 서버의 도메인이 달라서 발생하는 sameSite 이슈에 부딪히자 2차 멘붕이 왔다.

구글링 거의 3일 정도 했는데 찾은 정보로는 인증에 필요한 쿠키를 생성하지 못하였다...

다들 쿠키 옵션에 `sameSite: "none", secure: "none"` 을 주라고 하는데 이미 그 옵션은 세팅했고 이러면 아예 응답 헤더로 `Set-Cookie`를 해주지 못 하였다.

또 다른 방법으로는 다들 axios나 fetch 옵션에 `credential` 설정과 `express-session`에도 `credentials` 설정을 넣으라고 했지만 결과는 똑같았다.

다른 해결책으로 `express`에서 `trust-proxy`를 설정하라고 했으나 아주 일부분에서만 해결이 됐다.

클라이언트에서 `fetch`로 요청을 했을 때는 쿠키가 생겼으나 `axios`를 이용했을 때는 신기하게 쿠키 생성이 불가능했다.

또한 사파리 브라우저에서는 아예 응답 자체가 오지를 않았다.

따라서 이 방법도 실패... 시간이 너무 지체되는걸 느끼고 우리는 그냥 사파리를 포기하고 fetch를 사용하는걸로 반 포기 상태로 빠져버렸다.

근데 또 이게 오기가 생기더라 남들은 다 되는데 왜 우리만 안될까?

이때부터 나의 새벽 3,4시 취침이 시작됐다. 🤢 🤮

그리고 결국에는 프로젝트 마감 3일 전인가 문제를 해결했다.

모든건 똑같았다 단, 우리는 도메인을 두가지를 사용했다. 예를 들면 클라이언트에서는 surfEx.com 서버에서는 surfApi.com 이 방법의 문제점을 파악하고 우리는 현재 도메인을 생성했다.

클라이언트 surfsurf.co.uk, 서버 api.surfsurf.co.uk 그리고 이전과는 다르게 쿠키에 도메인 설정을 해주었다.

`domain : ".surfsurf.co.uk"`

결과는? 성공적이었고 나는 거기서 박수를 치며 소리 질렀다. 역시 불가능은 없더라.

아마 이번 프로젝트에서 가장 기쁜 순간이 아닌가 싶다. 🥳 🥳

![](https://images.velog.io/images/kdo0129/post/b2c4c15f-9be3-4762-b3ea-68d503e1456a/mainPage.gif)

### 😈 끝인 줄 알았지? 😈

당연히 끝이 아니지 그럼 그럼 그렇게 쉽게 끝날거 같지 않았어 시퀄라이즈로 모델 작성을 끝내고 세상을 다 가진거 같았는데 역시 위에서도 말했던 관계 테이블을 효율적으로 사용하는 방법에서 어려움을 느꼈다.

물론 그냥 쿼리를 여러번 날리거나 할 수도 있는 상황이었으나 나는 좀 더 '내가 사용한 ORM을 정말 이러 이러한 점이 편하고 좋았기 때문에 사용했다' 당당하게 말하고 싶었다.

또 구글 선생님의 힘을 얻어서 관계 형성과 동시에 자동으로 생성되는 get, add 메소드를 효과적으로 사용하였다.

또한 관계 테이블에서 사용할 수 있는 `include`를 사용해서 데이터를 보다 효과적으로 검색할 수 있었다.

따라서 최대한 시퀄라이즈에서 제공하는 기능들을 사용하는 코드로 최종적으로 전부 수정을 하였고 직접 쿼리문을 날리는 방식이 아닌 ORM을 사용했을 때 얻을 수 있는 장점에 대해서 경험했다고 생각한다.

![](https://images.velog.io/images/kdo0129/post/70624726-db6b-4e83-ae73-4457c35eb7f9/createWave.gif)

## 마치며

이번 1차 프로젝트가 어떻게 보면 팀원들과 같이 하는 인생 첫 팀 프로젝트인데 정말 좋은 팀원을 만난게 행운 같다.

실력을 떠나서 다들 서로를 배려하고 모자른 점을 채워주려고 노력을 많이 해주셨다.

프론트 분들도 고생이 많으셨지만 특히 같이 백엔드를 진행한 태원님이 정말 고생이 많으셨다.

내가 인증에서 막혀버려서 다른 부분에서 내 몫까지 처리를 하시느라....

'이게 될까?' 라고 생각했던 프로젝트가 결국에는 끝이 나더라 _~~**(물론 완벽한 끝은 아니었지만)**~~_

내가 개발자로 살아가면서 앞으로 이번 프로젝트에서 만난 문제들과는 비교할 수 없을 정도로 정말 많고 험난한 문제들을 마주할 것이다.

이번 프로젝트로 앞으로의 허들을 완벽하게 넘지는 못 하지만 **'넘을 수 있을거야..!'** 라는 자신감을 가지게 되었다.

### 계속해서 도전하자 불가능은 없다. 🔥

2주 동안 같이 고생한 팀원과 동기 모든 분들에게 박수를 보냅니다.👏🏼👏🏼👏🏼

![](https://images.velog.io/images/kdo0129/post/1624ec64-81d8-4a6f-9e8c-b2e7dae10162/jj1FP.gif)
